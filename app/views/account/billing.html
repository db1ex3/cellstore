<div class="container export">
    <h2 class="text-center" translate>Billing information</h2>
    <div class="row">
        <div class="col-md-4 col-lg-3">
            <div class="widget text-center">
                <div ang:round:progress data-round-progress-model="calls" data-round-progress-width="150" data-round-progress-height="150" data-round-progress-label-color="#428bca"
                    data-round-progress-outer-circle-background-color="#ECECEC" data-round-progress-outer-circle-foreground-color="#428bca" data-round-progress-outer-circle-width="23" data-round-progress-outer-circle-radius="60" 
                    data-round-progress-inner-circle-color="#EEEEEE" data-round-progress-inner-circle-width="1" data-round-progress-inner-circle-radius="42" data-round-progress-label-font="2.5em sans-serif"></div>
                <div translate>Api calls in billing cycle</div>
                <div>{{calls.from | date}} - {{calls.to | date}}</div>
            </div>
        </div>
        <div class="col-md-8 col-lg-9">
            <form>
                <fieldset>
                    <legend translate>
                        Subscription
                    </legend>
                    <div class="row">
                        <div class="col-sm-7">
                            <p ng-show="loadingSubscriptions"><i class="fa fa-spin fa-spinner"></i> <span translate>Loading subscriptions...</span></p>
                            <p ng-show="!loadingSubscriptions && subscriptions && subscriptions.length === 0" translate>
                                No subscriptions.
                            </p>
                            <p ng-show="!loadingSubscriptions && !loadingBillingInfo && !hasPro">
                                <button type="button" class="btn btn-primary btn-lg" ng-class="{ disabled: !billingInfo.billingData }" ng-click="subscribe('sec_pro')" translate>
                                    Sign Up for Pro
                                </button>
                                <h4 ng-show="!loadingSubscriptions && !loadingBillingInfo && !billingInfo.billingData" translate>
                                    Please <a ng-click="updateBillingInfo()">enter your billing information</a> before you sign up.
                                </h4>
                            </p>
                            <p ng-repeat="sub in subscriptions | limitTo: 5" ng-class="{ disabled: (sub['state'] !== 'active') }">
                                <span translate>Subscribed to <b>{{sub.plan.name}}</b> since {{sub.activatedAt | date }}</span>.
                                <span ng-show="sub.canceledAt" class="text-danger" translate>Canceled on {{sub.canceledAt | date }}.</span>
                                <span ng-show="!sub.canceledAt && sub.expiresAt" class="text-warning" translate>Expires on {{sub.expiresAt | date }}.</span>
                                <span ng-show="(sub['state'] === 'active')">
                                    <br><a ng-click="unsubscribe(sub.plan.planCode, sub.uuid)" translate>Cancel subscription</a>
                                </span>
                            </p>
                        </div>
                        <div ng-show="!loadingSubscriptions" class="col-sm-5">
                            <h4 translate>Pro Includes</h4>
                            <ul class="list-unstyled plus">
                                <li><i class="fa fa-check"></i> <span translate>Access to all SEC filings</span></li>
                                <li><i class="fa fa-check"></i> <span translate>UI access</span></li>
                                <li><i class="fa fa-check"></i> <span translate>API access</span></li>
                                <li>&nbsp;</li>
                                <li><i class="fa fa-check"></i> <span translate>1000 API calls per month</span></li>
                            </ul>
                        </div>
                    </div>
                </fieldset>
            </form>

            <script type="text/ng-template" id="subscribeModal.html">
            <div>
                <div class="modal-header"><h4 translate>Subscribe to Pro</h4></div>
                <form class="form-horizontal form-tight" name="model.form" id="subForm" ng-submit="submit()" novalidate>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="col-sm-5 control-label" translate>Price</label>
                            <div class="col-sm-7">
                                <h5>{{model.data.quantity}} x {{model.data.price}} {{model.data.currency}}</h5>
                            </div>
                        </div>
                        <div class="form-group" ng-show="showCoupon">
                            <label for="coupon" class="col-sm-5 control-label" translate>Coupon</label>
                            <div class="col-sm-5">
                                <div class="input-group">
                                  <input type="text" class="form-control" id="coupon" name="coupon" placeholder="Coupon Code" ng-model="model.data.coupon">
                                  <span class="input-group-btn">
                                    <button class="btn btn-primary" type="button" ng-click="applyCoupon()" translate>Apply</button>
                                  </span>
                                </div>
                                <span class="text-danger" ng-show="model.form.coupon.$error.invalid && (model.form.coupon.$dirty || attempted)" translate>
                                      Invalid coupon
                                </span>
                            </div>
                        </div>
                        <div class="form-group" ng-show="showCoupon">
                            <label class="col-sm-5 control-label" translate>Discount</label>
                            <div class="col-sm-7">
                                <h5>{{model.data.now.discount}} {{model.data.currency}}</h5>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-5 control-label" translate>Total</label>
                            <div class="col-sm-7">
                                <h5>{{model.data.now.total}} {{model.data.currency}}</h5>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a ng-click="showCoupon=true" ng-show="!showCoupon" class="pull-left" translate>I have a coupon!</a>
                        <input type="hidden" name="recurly-token" data-recurly="token">
                        <button class="btn btn-primary" id="recurly-submit" type="submit" ng-class="{ disabled: loading }">
                            <span ng-show="loading"><i class="fa fa-spinner fa-spin"></i> <span translate>Subscribing...</span></span>
                            <span ng-show="!loading" translate>Subscribe</span>
                        </button>
                        <button class="btn btn-default" id="recurly-cancel" type="button" ng-click="dismiss()" translate>Cancel</button>
                    </div>
                </form>
            </div>
            </script>

            <script type="text/ng-template" id="unsubscribeModal.html">
            <div>
                <div class="modal-header"><h4 translate>Cancel Subscription</h4></div>
                <form class="form-horizontal form-tight" role="form" name="model.form" ng-submit="submit()" novalidate>
                    <div class="modal-body">
                        <span translate>Are you sure you want to cancel this subscription?</span>
                    </div>
                    <div class="modal-footer">
                        <input type="hidden" name="recurly-token" data-recurly="token">
                        <button class="btn btn-danger" id="recurly-submit" type="submit" ng-class="{ disabled: loading }">
                            <span ng-show="loading"><i class="fa fa-spinner fa-spin"></i> <span translate>Unsubscribing...</span></span>
                            <span ng-show="!loading" translate>Yes</span>
                        </button>
                        <button class="btn btn-default" id="recurly-cancel" type="button" ng-click="dismiss()" translate>No</button>
                    </div>
                </form>
            </div>
            </script>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col-md-4 col-lg-3">
            <form class="widget">
                <fieldset>
                    <div ng-show="!loadingBillingInfo && billingInfo.billingData">
                        <address>
                            <strong>
                                <span ng-bind="billingInfo.billingData.firstName"></span>
                                <span ng-bind="billingInfo.billingData.lastName"></span>
                            </strong><br>
                            <div ng-bind="billingInfo.billingData.address1"></div>
                            <div ng-bind="billingInfo.billingData.address2"></div>
                            <span ng-bind="billingInfo.billingData.city"></span>, <span ng-bind="billingInfo.billingData.state"></span> <span ng-bind="billingInfo.billingData.zip"></span> - <span ng-bind="billingInfo.billingData.country"></span><br>
                        </address>
                        <p>
                            <strong translate>Payment method</strong><br>
                            <span ng-bind="billingInfo.billingData.cardType"></span> ******<span ng-bind="billingInfo.billingData.lastFour"></span><br>
                            <span translate>Expiring</span> <span ng-bind="billingInfo.billingData.month"></span>/<span ng-bind="billingInfo.billingData.year"></span>
                        </p>
                    </div>
                    <div ng-show="!loadingBillingInfo && !billingInfo.billingData">
                        <p translate>
                            No billing information present
                        </p>
                    </div>
                    <p ng-show="loadingBillingInfo"><i class="fa fa-spin fa-spinner"></i> <span translate>Loading billing information...</span></p>
                    <p ng-show="!loadingBillingInfo">
                        <button type="button" ng-click="updateBillingInfo()" class="btn btn-primary">
                            <span ng-show="!billingInfo.billingData" translate>Enter Billing Information</span>
                            <span ng-show="billingInfo.billingData" translate>Update Billing Information</span>
                        </button>
                    </p>
                </fieldset>
            </form>

            <script type="text/ng-template" id="billingInfoModal.html">
            <div>
                <div class="modal-header"><h4 translate>Billing Information</h4></div>
                <form class="form-horizontal form-tight" role="form" name="model.form" ng-submit="submit()" novalidate>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="number" class="col-sm-3 hidden-xs control-label" translate>Card</label>
                            <div class="col-sm-7 col-xs-8">
                                <input type="text" class="form-control" id="number" name="number" placeholder="Card Number" ng-model="model.billingData.number" data-recurly="number" required>
                                <span class="text-danger" ng-show="model.form.number.$error.required && (model.form.number.$dirty || attempted)" translate>
                                      Required
                                </span>
                                <span class="text-danger" ng-show="!model.form.number.$error.required && model.form.number.$error.invalid && (model.form.number.$dirty || attempted)" translate>
                                      Invalid
                                </span>
                            </div>
                            <div class="col-sm-2 col-xs-4">
                                <input type="text" class="form-control" id="ccv" name="ccv" placeholder="CCV" ng-model="model.billingData.ccv" data-recurly="ccv">
                                <span class="text-danger" ng-show="model.form.ccv.$error.invalid && (model.form.ccv.$dirty || attempted)" translate>
                                      Invalid
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="month" class="col-sm-3 hidden-xs control-label" translate>Expiring</label>
                            <div class="col-sm-3 col-xs-4">
                                <input type="text" class="form-control" id="month" name="month" placeholder="MM" ng-model="model.billingData.month" data-recurly="month" required maxlength="2">
                                <span class="text-danger" ng-show="model.form.month.$error.required && (model.form.month.$dirty || attempted)" translate>
                                      Required
                                </span>
                                <span class="text-danger" ng-show="!model.form.month.$error.required && model.form.month.$error.invalid && (model.form.month.$dirty || attempted)" translate>
                                      Invalid
                                </span>
                            </div>
                            <div class="col-sm-4 col-xs-4">
                                <input type="text" class="form-control" id="year" name="year" placeholder="YYYY" ng-model="model.billingData.year" data-recurly="year" required maxlength="4">
                                <span class="text-danger" ng-show="model.form.year.$error.required && (model.form.year.$dirty || attempted)" translate>
                                      Required
                                </span>
                                <span class="text-danger" ng-show="!model.form.year.$error.required && model.form.year.$error.invalid && (model.form.year.$dirty || attempted)" translate>
                                      Invalid
                                </span>
                            </div>
                        </div>
                        <hr>
                        <div class="form-group">
                            <label for="firstname" class="col-sm-3 hidden-xs control-label" translate>First Name</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="first_name" name="first_name" placeholder="First Name" ng-model="model.billingData.first_name" data-recurly="first_name" required>
                                <span class="text-danger" ng-show="model.form.first_name.$error.required && (model.form.first_name.$dirty || attempted)" translate>
                                      Required
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="lastname" class="col-sm-3 hidden-xs control-label" translate>Last Name</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Last Name" ng-model="model.billingData.last_name" data-recurly="last_name" required>
                                <span class="text-danger" ng-show="model.form.last_name.$error.required && (model.form.last_name.$dirty || attempted)" translate>
                                      Required
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="address1" class="col-sm-3 hidden-xs control-label" translate>Address</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="address1" name="address1" placeholder="Address line 1" ng-model="model.billingData.address1" data-recurly="address1" required>
                                <span class="text-danger" ng-show="model.form.address1.$error.required && (model.form.address1.$dirty || attempted)" translate>
                                      Required
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-9 col-sm-offset-3">
                                <input type="text" class="form-control" id="address2" name="address2" placeholder="Address line 2" ng-model="model.billingData.address2" data-recurly="address2">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-3 col-xs-5">
                                <input type="text" class="form-control" id="city" name="city" placeholder="City" ng-model="model.billingData.city" data-recurly="city" required>
                                <span class="text-danger" ng-show="model.form.city.$error.required && (model.form.city.$dirty || attempted)" translate>
                                      Required
                                </span>
                                <span class="text-danger" ng-show="!model.form.city.$error.required && model.form.city.$error.invalid && (model.form.city.$dirty || attempted)" translate>
                                      Invalid
                                </span>
                            </div>
                            <div class="col-sm-2 col-xs-3">
                                <select class="form-control" id="state" name="state" placeholder="State" ng-model="model.billingData.state" data-recurly="state" required>
                                    <option>AL</option><option>AK</option><option>AZ</option><option>AR</option><option>CA</option><option>CO</option><option>CT</option><option>DE</option><option>DC</option><option>FL</option><option>GE</option><option>HI</option><option>ID</option><option>IL</option><option>IN</option><option>IA</option><option>KS</option><option>KY</option><option>LA</option><option>ME</option><option>MD</option><option>MA</option><option>MI</option><option>MN</option><option>MS</option><option>MO</option><option>MT</option><option>NE</option><option>NV</option><option>NH</option><option>NJ</option><option>NM</option><option>NY</option><option>NC</option><option>ND</option><option>OH</option><option>OK</option><option>OR</option><option>PA</option><option>RI</option><option>SC</option><option>SD</option><option>TN</option><option>TX</option><option>UT</option><option>VT</option><option>VA</option><option>WA</option><option>WV</option><option>WI</option><option>WY</option>
                                </select>
                                <span class="text-danger" ng-show="model.form.state.$error.required && (model.form.state.$dirty || attempted)" translate>
                                      Required
                                </span>
                                <span class="text-danger" ng-show="!model.form.state.$error.required && model.form.state.$error.invalid && (model.form.state.$dirty || attempted)" translate>
                                      Invalid
                                </span>
                            </div>
                            <div class="col-sm-3 col-xs-4">
                                <input type="text" class="form-control" id="postal_code" name="postal_code" placeholder="Zip" ng-model="model.billingData.postal_code" data-recurly="postal_code" required maxlength="5">
                                <span class="text-danger" ng-show="model.form.postal_code.$error.required && (model.form.postal_code.$dirty || attempted)" translate>
                                      Required
                                </span>
                                <span class="text-danger" ng-show="!model.form.postal_code.$error.required && model.form.postal_code.$error.invalid && (model.form.postal_code.$dirty || attempted)" translate>
                                      Invalid
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="hidden" name="recurly-token" data-recurly="token">
                        <button class="btn btn-primary" id="recurly-submit" type="submit" translate>Save Billing Information</button>
                        <button class="btn btn-default" id="recurly-cancel" type="button" ng-click="dismiss()" translate>Cancel</button>
                    </div>
                </form>
            </div>
            </script>
        </div>
        <div class="col-md-8 col-lg-9">
            <form>
                <fieldset>
                    <legend translate>
                        Invoices
                    </legend>
                    <div ng-show="invoices && invoices.length === 0">
                        <p translate>No invoices.</p>        
                    </div>
                    <div>
                        <table class="table table-justcolumns" ng-show="invoices && invoices.length > 0">
                            <thead>
                                <tr>
                                    <th translate>Invoice ID</th>
                                    <th translate>Date</th>
                                    <th translate>Status</th>
                                    <th class="text-right" translate>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="invoice in invoices">
                                    <td><a ng-href="{{getInvoiceURL(invoice.invoiceNumber, 'pdf')}}" target="_blank">#{{invoice.invoiceNumber}}</a></td>
                                    <td>{{invoice.createdAt | date}}</td>
                                    <td>{{invoice.state}}</td>
                                    <td class="text-right">{{(invoice.totalInCents / 100) | number }} {{invoice.currency}}</td>
                                </tr>
                            </tbody>
                        </table>
                        <p ng-show="loadingInvoices"><i class="fa fa-spin fa-spinner"></i> <span translate>Loading invoices...</span></p>
                        <div ng-show="!loadingInvoices && (more > 0)"><span translate>{{more}} older.</span> <a ng-click="getInvoices()" translate>Load more...</a></div>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
</div>
